## C++拷贝构造函数（复制构造函数）



**拷贝构造函数**是一种**特殊的构造函数**，它在创建对象时，是使用同一类中之前创建的对象来初始化新创建的对象。拷贝构造函数通常用于：

- 通过使用另一个**同类型的对象来初始化新创建的对象**。

- **复制对象**把它**作为参数**传递给函数。

- **复制对象**，并从函数**返回这个对象**。



> 复制构造函数参数为类对象本身的引用，用于根据一个已存在的对象股指出一个新的该类的对象，一般在函数重会将已存在对象的数据成员的值复制一份到新创建的对象中。
> 
> 若没有显示的写复制复制构造函数，系统会默认创建一个复制构造函数，但当类中有指针成员时，由系统默认创建该复制构造函数会存在风险，"深复制，浅复制"



**必须定义复制构造函数的情况：**

只包含类类型成员或内置类型（但不是指针类型）成员的类，无须显式地定义复制构造函数也可以复制；有的类有一个**数据成员是指针**，或者是有成员表示**在构造函数中分配的其他资源**，这两种情况下都必须定义复制构造函数。

如果在类中没有定义拷贝构造函数，编译器会自行定义一个。如果类带有指针变量，并有动态内存分配，则它必须有一个拷贝构造函数。拷贝构造函数的最常见形式如下：

```cpp
classname (const classname &obj) {
   // 构造函数的主体
}
```

**拷贝构造函数中即使是private成员，也可以拷贝**

```cpp
#include <iostream>

using namespace std;

class Line
{
   public:
      int getLength( void );
      Line( int len );             // 简单的构造函数
      Line( const Line &obj);      // 拷贝构造函数
      ~Line();                     // 析构函数

   private:
      int *ptr;                    //有指针，定义拷贝构造函数

};

// 成员函数定义，包括构造函数
Line::Line(int len)
{
    cout << "调用构造函数" << endl;
    // 为指针分配内存
    ptr = new int;
    *ptr = len;                    //构造函数中分配资源，需要定义拷贝构造函数

}

Line::Line(const Line &obj)
{
    cout << "调用拷贝构造函数并为指针 ptr 分配内存" << endl;
    ptr = new int;
    *ptr = *obj.ptr;             // 拷贝值，即使ptr是private成员，也可以拷贝
                                 // 否则两个指针成员将指向同一个内存

}

Line::~Line(void)
{
    cout << "释放内存" << endl;
    delete ptr;
}
int Line::getLength( void )
{
    return *ptr;
}

void display(Line obj)              //对象做参数，调用拷贝构造函数复制对象，结束后调用析构函数删除对象

{
   cout << "line 大小 : " << obj.getLength() <<endl;
}

// 程序的主函数
int main( )
{
   Line line1(10);

   Line line2 = line1;            // 通过同类型对象创建新对象，调用了拷贝构造函数
   Line line3 = 10;               // 调用构造函数得到新对象

   display(line1);                //对象做参数，调用拷贝构造函数

   display(line2);                //对象做参数，调用拷贝构造函数


   return 0;
}
```

```cpp
调用构造函数
调用拷贝构造函数并为指针 ptr 分配内存
调用构造函数
调用拷贝构造函数并为指针 ptr 分配内存
line 大小 : 10
释放内存
调用拷贝构造函数并为指针 ptr 分配内存
line 大小 : 10
释放内存
释放内存
释放内存
```
